<!--Programmer: Chris Tralie!-->
<!--Purpose: Front end point chooser / debugger for line segment intersection function!-->
<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<!-- This is how you include external scripts in Javascript !-->
<body>
<h name = "Asteroids"> Asteroids</h>
<table>
  <tr>
    <td width = "100">
      <button type = "button" onclick = "restart()">Restart</button>
    </td>
  </tr>
  <tr>
    <td> Score: <a id="Score"></a></td>
  </tr>
</table>

<canvas id = "segcanvas" width = "700" height = "500" style="border:1px solid #777777;">

<script>

var canvas = document.getElementById("segcanvas"),
ctx = canvas.getContext("2d");

var x = 250,  //initial x
    y = 250,  // initial y
    velY = 0,
    velX = 0,
    speed = 1, // max speed
    friction = 0.98, // friction
    score = 0;
    keys = [],
    shots = [],
    asteroids = [];

function update() {
    // check the keys and do the movement.
    if (keys[38]) {
        if (velY > -speed) {
            velY--;
        }
    }
    if (keys[40]) {
        if (velY < speed) {
            velY++;
        }
    }
    if (keys[39]) {
        if (velX < speed) {
            velX++;
        }
    }
    if (keys[37]) {
        if (velX > -speed) {
            velX--;
        }
    }
    if (keys[88]) { // gun shot
      keys[88] = false;
    }

    // apply some friction to y velocity.
    velY *= friction;
    y += velY;

    // apply some friction to x velocity.
    velX *= friction;
    x += velX;

    // bounds checking
    if (x >= canvas.width - 5) {
        x = canvas.width - 5;
    } else if (x <= 5) {
        x = 5;
    }

    if (y > canvas.height) {
        y = canvas.height;
    } else if (y <= 5) {
        y = 5;
    }

    // do the drawing
    repaint();

    setTimeout(update, 10);

}
function asteroid() {
  var coordinates = getRandomCoordinates();
  var velocity = getRandomVelocity();
  asteroids.push(coordinates.concat(velocity));
}
function repaint() {
  repaintShip();
  repaintShots();
  repaintAsteroids();
}
function repaintShip(){
  checkShipCollision();
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  ctx.arc(x, y, 5, 0, Math.PI * 2);
  ctx.fillStyle = "#ffffff";
  ctx.fill();
}
function repaintShots(){
  for (i=0;i<shots.length;i++){
    // adjust coordinates
    shots[i][1] += shots[i][3];
    shots[i][0] += shots[i][2];
    //delete it if its out of the page
    var Cx = shots[i][0];
    var Cy = shots[i][1];
    if(Cx > canvas.width || Cx < 0 || Cy > canvas.height || Cy < 0){
      shots.splice(i,1);
    }
    else {
      ctx.beginPath();
      ctx.arc(shots[i][0],shots[i][1], 2, 0, Math.PI * 2);
      ctx.fillStyle = "#ffffff";
      ctx.fill();
      checkAstroidCollision(shots[i],i);
    }
  }
}
function repaintAsteroids(){
  for (i=0;i<asteroids.length;i++){
    // adjust coordinates
    asteroids[i][1] += asteroids[i][3];
    asteroids[i][0] += asteroids[i][2];
    //delete it if its out of the page
    var Cx = asteroids[i][0];
    var Cy = asteroids[i][1];
    if(Cx > canvas.width || Cx < 0 || Cy > canvas.height || Cy < 0){
      asteroids.splice(i,1);
    }
    else{
      ctx.beginPath();
      ctx.moveTo(asteroids[i][0]+10, asteroids[i][1]+10);
      ctx.lineTo(asteroids[i][0]+8, asteroids[i][1]+5);
      ctx.lineTo(asteroids[i][0]+10, asteroids[i][1]-10);
      ctx.lineTo(asteroids[i][0], asteroids[i][1]-5);
      ctx.lineTo(asteroids[i][0]-10, asteroids[i][1]-10);
      ctx.lineTo(asteroids[i][0]-3, asteroids[i][1]+2);
      ctx.lineTo(asteroids[i][0]-10, asteroids[i][1]+10);
      ctx.closePath();
      ctx.lineWidth = 2;
      ctx.strokeStyle = 'White';
      ctx.stroke();
      //ctx.fill();
      //ctx.arc(asteroids[i][0],asteroids[i][1], 10, 0, Math.PI * 2);

    }
  }
}
function checkAstroidCollision(shot,index){
  for (j=0; j < asteroids.length; j++){
    //check if distance from circle center to point in  is < radius
    if ( Math.sqrt( Math.pow(asteroids[j][0] - shot[0],2) + Math.pow(asteroids[j][1] - shot[1],2)) < 12 ) { // Impact
        shots.splice(index,1);
        asteroids.splice(j,1);
        score++;
        document.getElementById('Score').innerHTML = "" + score;
    }
  }
}
function checkShipCollision(){
  for (k=0; k < asteroids.length; k++){
    //check if distance from circle center to point in  is < radius
    if ( Math.sqrt( Math.pow(asteroids[k][0] - x,2) + Math.pow(asteroids[k][1] - y,2)) < 15 ) { // Impact
      if (confirm('You Lost :( !! Wanna play Again?')) {
        return;
      }
      else {}
    }
  }
}
function getRandomCoordinates() {
  return [Math.floor(Math.random() * (canvas.height - 1)),Math.floor(Math.random() * (canvas.height - 1))];
}
function getRandomVelocity() {
  return [Math.random(),Math.random()];
}
function restart() {
  var x = 250,  //initial x
      y = 250,  // initial y
      velY = 0,
      velX = 0,
      speed = 1, // max speed
      friction = 0.98, // friction
      score = 0;
      keys = [],
      shots = [],
      asteroids = [];
      update();
}
update();

//Astroid creator
setInterval(function(){
    asteroid();
}, 2000);

// Disable page scrolling
window.addEventListener("keydown", function(e) {
    // space and arrow keys
    if([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);

//Shooting and Movement events
document.body.addEventListener("keydown", function (e) {
    keys[e.keyCode] = true;

    //shots
    if (e.keyCode == 88){
      shots.push([x,y,velX,velY]);
    }
});
document.body.addEventListener("keyup", function (e) {
    keys[e.keyCode] = false;
  });
document.body.addEventListener("shot", function (e) {
    keys[e.keyCode] = false;
  });
</script>


</body>
</html>
