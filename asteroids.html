<!--Programmer: Chris Tralie!-->
<!--Purpose: Front end point chooser / debugger for line segment intersection function!-->
<html>
<head>
<!-- This is how you include external scripts in Javascript !-->
<body>
<h2><a name = "asteroids"> asteroids</a></h2>
<table>
<tr>
<td width = "200">
<button type = "button" onclick = "update()">Start</button><BR><BR>
</table>
</td>
<td>
<canvas id = "segcanvas" width = "500" height = "500" style="border:1px solid #000000;">
</canvas>
</td>
</tr>
</table>

<script>

var canvas = document.getElementById("segcanvas"),
ctx = canvas.getContext("2d");

canvas.width = canvas.height = 500;

var x = 250,  //initial x
    y = 250,  // initial y
    velY = 0,
    velX = 0,
    speed = 1, // max speed
    friction = 0.98, // friction
    keys = [],
    shots = [],
    asteroids = [];

function update() {

    // check the keys and do the movement.
    if (keys[38]) {
        if (velY > -speed) {
            velY--;
        }
    }

    if (keys[40]) {
        if (velY < speed) {
            velY++;
        }
    }
    if (keys[39]) {
        if (velX < speed) {
            velX++;
        }
    }
    if (keys[37]) {
        if (velX > -speed) {
            velX--;
        }
    }
    if (keys[88]) { // gun shot
      console.log(shots);
      keys[88] = false;
    }

    // apply some friction to y velocity.
    velY *= friction;
    y += velY;

    // apply some friction to x velocity.
    velX *= friction;
    x += velX;

    // bounds checking
    if (x >= 495) {
        x = 495;
    } else if (x <= 5) {
        x = 5;
    }

    if (y > 495) {
        y = 495;
    } else if (y <= 5) {
        y = 5;
    }

    // do the drawing
    repaint();

    setTimeout(update, 10);

}
function asteroid() {
  var coordinates = getRandomCoordinates();
  var velocity = getRandomVelocity();
  asteroids.push(coordinates.concat(velocity));
}
function repaint() {
  ctx.clearRect(0, 0, 500, 500);
  ctx.beginPath();
  ctx.arc(x, y, 5, 0, Math.PI * 2);
  ctx.fillStyle = "#000000";
  ctx.fill();

  repaintShots();
  repaintasteroids();
}
function repaintShots(){
  for (i=0;i<shots.length;i++){
    // adjust coordinates
    shots[i][1] += shots[i][3];
    shots[i][0] += shots[i][2];
    //delete it if its out of the page
    var Cx = shots[i][0];
    var Cy = shots[i][1];
    if(Cx > canvas.width || Cx < 0 || Cy > canvas.height || Cy < 0){
      shots.splice(i,1);
    }
    else {
      ctx.beginPath();
      ctx.arc(shots[i][0],shots[i][1], 5, 0, Math.PI * 2);
      ctx.fillStyle = "#00A308";
      ctx.fill();
      for (j=0; j < asteroids.length; j++){
        //check if distance from circle center to point in  is < radius
        if ( Math.sqrt( Math.pow(asteroids[j][0] - shots[i][0],2) + Math.pow(asteroids[j][1] - shots[i][1],2)) < 20 ) { // Impact
            shots.splice(i,1);
            asteroids.splice(i,1);
        }
      }
    }

  }
}

function repaintasteroids(){
  for (i=0;i<asteroids.length;i++){
    // adjust coordinates
    asteroids[i][1] += asteroids[i][3];
    asteroids[i][0] += asteroids[i][2];
    //delete it if its out of the page
    var Cx = asteroids[i][0];
    var Cy = asteroids[i][1];
    if(Cx > canvas.width || Cx < 0 || Cy > canvas.height || Cy < 0){
      asteroids.splice(i,1);
    }
    else{
      ctx.beginPath();
      ctx.arc(asteroids[i][0],asteroids[i][1], 10, 0, Math.PI * 2);
      ctx.fillStyle = "#0800B8";
      ctx.fill();
    }
  }
}
function checkImpact(shot) {

}

function getRandomCoordinates() {
  return [Math.floor(Math.random() * (canvas.height - 1)),Math.floor(Math.random() * (canvas.height - 1))];
}
function getRandomVelocity() {
  return [Math.random(),Math.random()];
}
update();

setInterval(function(){
    asteroid();
}, 2000);
// key events
document.body.addEventListener("keydown", function (e) {
    keys[e.keyCode] = true;

    //shots
    if (e.keyCode == 88){
      shots.push([x,y,velX,velY]);
    }
});
document.body.addEventListener("keyup", function (e) {
    keys[e.keyCode] = false;
  });
  document.body.addEventListener("shot", function (e) {
      keys[e.keyCode] = false;
    });
</script>


</body>
</html>
