<!--Programmer: Aaron Liberatore !-->
<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src = "Utilities.js"></script>
</head>

<body>
  <h1 name = "Asteroids"> Asteroids</h1>
<div id="main_wrap">
  <div id="sidebar">
    <table>
      <tr>
          <td> High Score: <a id="hScore"></a> <a id="hScoreName"></a></td>
      </tr>
      <tr>
        <td> Score: <a id="Score"></a></td>
      </tr>
      <tr>
        <td height = "50">
          <button onclick = "restart()" class="myButton">Restart</button>
          <button onclick = "pause()" class="myButton">Pause</button>
        </td>
      </tr>
    </table>
  </div>
  <div id="content">
    <canvas id = "segcanvas" width = "700" height = "500" style="border:1px solid #777777;">
  </div>
</div>â€‹




<script>

document.getElementById('hScore').innerHTML = "" + localStorage.getItem('HScore'); // Set that high score
document.getElementById('hScoreName').innerHTML = "" + localStorage.getItem('HScoreName'); // Set that high score

//Set up Canvas
var canvas = document.getElementById("segcanvas"),
ctx = canvas.getContext("2d");
var image = new Image();
image.src = "./images/shapeship.png";

var ship = new Sprite(250,250,[[0,6],[4,-4],[-4,-4]]),
    speed = 1,       // max speed
    friction = 0.93, // friction
    score = 0;
    keys = [],
    shots = [],
    lastShot = Date.now();
    aliens = [],
    asteroids = [],

    paused = false;
    interval = 2000,
    hScore = localStorage.getItem('HScore');
asteroid();
asteroid();
alien()
// Purpose: Adjusts velocity vectors and ship position
function update() {
    // check the keys and do the movement.
    //Up Movement
    if (keys[38] || keys[87]) {
        if (ship.vel < speed) {
            ship.vel++;
        }
    }
    //Down Movement
    if (keys[40] || keys[83]) {
        if (ship.vel < speed) {
            //ship.vel++;
        }
    }
    //Left Rotational Movement
    if (keys[39] || keys[68]) {
        ship.theta += 0.4;
    }
    //Right Rotational Movement
    if (keys[37] || keys[65]) {
        ship.theta -= 0.4;
    }
    if (keys[76] || keys[88]) { // gun shot
      keys[76] = false;
      keys[88] = false;
    }
    // Apply some friction to forward velocity and rotational velocity
    ship.vel *= friction;
    ship.theta *= friction;

    ship.update();
    ship.boundsCheck();
    repaint();

    setTimeout(update, 10);

}

//Purpose: Creates a new asteroid with a random velocity
function asteroid() {
  var coors = getRandomCoordinates();
  var velocity = getRandomVelocity();

  if (ship.x+50 >= coors[0] && ship.x-50 <= coors[0] && ship.y+50 >= coors[1] && ship.y-50 <= coors[1]){
    coors[0]+=100;
    coors[1]+=100;
  }

  var size = Math.ceil(Math.random() * (3));
  var transforms = [[10,10],[8,5],[10,-10],[0,-5],[-10,-10],[-3,2],[-10,10]];
  var asteroid = new Sprite(coors[0],coors[1],transforms);
  asteroid.dir = velocity;
  asteroid.vel = 1;
  asteroid.scale = 1;
  asteroids.push(asteroid);

}
//Purpose: Creates a new alien with a random velocity
function alien(){
    var transform = [[-10, 0],[-5,5],[10,0],[5,-5],[-5,-5],[5,-5],[4,-5],[2,-8],[-2,-8],[-4,-5],[-5,-5],[-10,0],[10,0]];

    var coor = getRandomCoordinates();
    var velocity = getRandomVelocity();
    if (ship.x+50 <= coor[0] && ship.x-50 <= coor[0] && ship.y+50 <= coor[1] && ship.y-50 <= coor[1]){
      coor[0]+=30;
      coor[1]+=30;
    }
    var alien = new Sprite(coor[0],coor[1],transform);
    asteroid.dir = velocity;
    asteroid.vel = 1;
    asteroid.scale = 1;
    aliens.push(alien);
}

//////////BULLET COLLISIONS//////////////
//Check if a shots collides with an Alien Ship
function checkAlienShipCollision(shot,l){
  for (var h=0; h < aliens.length; h++){
    var sht = [shot[0],shot[1]];
    if (shot[5] != "#FF0000" && point_in_polygon(aliens[h].coor, sht)) {
        shots.splice(l,1);
        aliens.splice(h,1);
        score++;
        document.getElementById('Score').innerHTML = "" + score;
    }
  }
}
//Check if a shots collides with an asteroid
function checkAsteroidCollision(shot,index){
  checkShipCollisionBullets();
  for (var j=0; j < asteroids.length; j++){
    var aster = asteroids[j];
    var sht = [shot[0],shot[1]];
    if (point_in_polygon(aster.coor, sht)) {
        shots.splice(index,1);
        // The Asteroid should be split in 2 and new velocity vectors be created
        if(aster.scale > 1){
          aster.scale--;
          var nVelocity = getRandomVelocity();
          var transforms = [[10,10],[8,5],[10,-10],[0,-5],[-10,-10],[-3,2],[-10,10]];
          var nAster = new Sprite(aster.x,aster.y,transforms);
          nAster.dir = nVelocity;
          nAster.vel = nVelocity[0];
          nAster.scale = aster.scale;
          asteroids.push(nAster);
        }
        else{
          asteroids.splice(j,1);
        }
        score++;
        if(shot[5] != "#FF0000"){document.getElementById('Score').innerHTML = "" + score;}
        return true;
    }
  }
  return false;
}
//Check if user ship collides with bullets
function checkShipCollisionBullets(){
  for(var p=0; p < shots.length;p++){
    if (shots[p][4] > 50 && point_in_polygon(ship.coor, shots[p])) {
      if (confirm('You Shot Yourself!!')) {
        if(score > hScore || hScore == null){
          var person = prompt("Please enter your name (Maximum limit 16)", "Harry Potter");
          localStorage.setItem('HScore', score);
          localStorage.setItem('HScoreName', person.slice(0,17));
        }
        location.reload();
      }
    }
  }
}
//////////OBJECT COLLISIONS//////////////
//Check if an alien ship collides with the user ship
function checkAlienCollision(shot,index){
  for (var g=0; g < aliens.length; g++){
    var alien_pts = [[aliens[g][0]-10, aliens[g][1]],[aliens[g][0]-5, aliens[g][1]+5],[aliens[g][0]+5, aliens[g][1]+5],[aliens[g][0]+10, aliens[g][1]],[aliens[g][0]+5, aliens[g][1]-5],[aliens[g][0]+4, aliens[g][1]-5],[aliens[g][0]+2, aliens[g][1]-8],[aliens[g][0]-2, aliens[g][1]-8],[aliens[g][0]-4, aliens[g][1]-5],[aliens[g][0]-5, aliens[g][1]-5],[aliens[g][0]-10, aliens[g][1]],[aliens[g][0]+10, aliens[g][1]]];
    if (pts_in_polygon(aliens[g].coor, ship.coor)) {
      if (confirm('An Alien Killed You!!')) {
        if(score > hScore || hScore == null){
          var person = prompt("Please enter your name (Maximum limit 16)", "Harry Potter");
          localStorage.setItem('HScore', score);
          localStorage.setItem('HScoreName', person.slice(0,17));
        }
        location.reload();
      }
    }
  }
}
//Purpose: Check if an astroid collides with the user ship
function checkShipCollision(){
  checkAlienCollision();
  for (var k=0; k < asteroids.length; k++){
    var aster = asteroids[k];
    var scale = aster.scale;
    if (pts_in_polygon(aster.coor, ship.coor)){// Impact
      if (confirm('You Lost!!')) {
        if(score > hScore || hScore == null){
          var person = prompt("Please enter your name (Maximum limit 16)", "Harry Potter");
          localStorage.setItem('HScore', score);
          localStorage.setItem('HScoreName', person.slice(0,17));
        }
        location.reload();
      }
    }
  }
}
function randomizeAliens(){
  for(var q=0; q < aliens.length; q++){
    var vel = getRandomVelocity();
    aliens[q][2] = vel[0];
    aliens[q][3] = vel[1];
  }
}
function aliensShoot(){
  for(var w=0; w < aliens.length; w++){
    if(Math.random() < 0.5){
      var b = 2; // Max speed
      var a = 1; // Min speed
      var shotVX = (b-a)*((ship.x - aliens[w][0])/ canvas.width);
      var shotVY = (b-a)*((ship.y - aliens[w][1])/ canvas.height);
      if(shotVX < 0){
        shotVX -= a;
      } else{
        shotVX += a;
      }
      if(shotVY < 0){
        shotVY -= a;
      }
      else{
        shotVY += a;
      }
      shots.push([aliens[w][0],aliens[w][1],shotVX,shotVY,0,"#FF0000"]);
    }
  }
}
// Restart game function
function restart() {
  location.reload();
}
function pause() {
    if(paused){paused = false;}
    else{paused = true;}
    while(!paused){}
}
update();

// Creates Asteroid every on each interval
setInterval(function(){
    asteroid();
    //randomizeAliens();
    //aliensShoot();
}, interval);

setInterval(function(){
    //alien();
}, 10000);
// Adjusts interval; thus, affecting difficulty
setInterval(function(){
  if ( interval > 100){
    interval = interval - 100;
  }
}, 7000);

// Disable page scrolling
window.addEventListener("keydown", function(e) {
    // space and arrow keys
    if([32, 37, 38, 39, 40, 87, 83, 68, 65].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);

//Shooting and Movement events
document.body.addEventListener("keydown", function (e) {
    keys[e.keyCode] = true;
    //Is it a shot?
    if (e.keyCode == 88 || e.keyCode == 76){
        // Monitor Shot Rate
        if(Date.now() - lastShot > 250){
              shots.push([ship.coor[0][0],ship.coor[0][1],ship.dir[0]*2,ship.dir[1]*2,0,"#FFFFFF"]);
              lastShot = Date.now()
        }
    }
});
document.body.addEventListener("keyup", function (e) {
    keys[e.keyCode] = false;
  });
</script>


</body>
</html>
