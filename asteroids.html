<!--Programmer: Aaron Liberatore !-->
<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src = "Utilities.js"></script>
</head>

<body>
  <h1 name = "Asteroids"> Asteroids</h1>
<div id="main_wrap">
  <div id="sidebar">
    <table>
      <tr>
          <td> High Score: <a id="hScore"></a> <a id="hScoreName"></a></td>
      </tr>
      <tr>
        <td> Score: <a id="Score"></a></td>
      </tr>
      <tr>
        <td height = "50">
          <button onclick = "restart()" class="myButton">Restart</button>
        </td>
      </tr>
    </table>
  </div>
  <div id="content">
    <canvas id = "segcanvas" width = "700" height = "500" style="border:1px solid #777777;">
  </div>
</div>â€‹




<script>

document.getElementById('hScore').innerHTML = "" + localStorage.getItem('HScore'); // Set that high score
document.getElementById('hScoreName').innerHTML = "" + localStorage.getItem('HScoreName'); // Set that high score

//Set up Canvas
var canvas = document.getElementById("segcanvas"),
ctx = canvas.getContext("2d");
var image = new Image();
image.src = "./images/ship.png";

var x = 250,  //initial x
    y = 250,  // initial y
    velY = 0,
    velX = 0,
    speed = 1, // max speed
    friction = 0.93, // friction
    score = 0;
    keys = [],
    shots = [],
    asteroids = [],
    interval = 2000,
    hScore = localStorage.getItem('HScore');

// Purpose: Adjusts velocity vectors and ship position
function update() {
    // check the keys and do the movement.
    if (keys[38]) {
        if (velY > -speed) {
            velY--;
        }
    }
    if (keys[40]) {
        if (velY < speed) {
            velY++;
        }
    }
    if (keys[39]) {
        if (velX < speed) {
            velX++;
        }
    }
    if (keys[37]) {
        if (velX > -speed) {
            velX--;
        }
    }
    if (keys[88]) { // gun shot
      keys[88] = false;
    }
    // apply some friction to y velocity.
    velY *= friction;
    y += velY;

    // apply some friction to x velocity.
    velX *= friction;
    x += velX;
    // bounds checking
    if (x >= canvas.width) {
        x = x % canvas.width;
    } else if (x <= 0) {
        x = x + canvas.width;
    }

    if (y >= canvas.height) {
        y = y % canvas.height;
    } else if (y <= 0) {
        y = y + canvas.height;
    }

    // do the drawing
    repaint();

    setTimeout(update, 10);

}

//Purpose: Creates a new asteroid with a random velocity
function asteroid() {
  var coordinates = getRandomCoordinates();
  var velocity = getRandomVelocity();
  if (x+20 <= coordinates[0] && x-20 <= coordinates[0] && y+20 <= coordinates[1] && y-20 <= coordinates[1]){
    coordinates[0]+=30;
    coordinates[1]+=30;
  }
  var size = Math.ceil(Math.random() * (3));
  velocity.push(size);
  asteroids.push(coordinates.concat(velocity));
}

//Purpose: Check if a shot collides with an astroid
function checkAsteroidCollision(shot,index){
  for (j=0; j < asteroids.length; j++){
    var scale = asteroids[j][4];
    var sht = [shot[0],shot[1]];
    var pts = [[asteroids[j][0]+10*scale, asteroids[j][1]+10*scale],[asteroids[j][0]+8*scale, asteroids[j][1]+5*scale],[asteroids[j][0]+10*scale, asteroids[j][1]-10*scale],[asteroids[j][0], asteroids[j][1]-5*scale],[asteroids[j][0]-10*scale, asteroids[j][1]-10*scale],[asteroids[j][0]-3*scale, asteroids[j][1]+2*scale],[asteroids[j][0]-10*scale, asteroids[j][1]+10*scale]];
    // Tests if point is within the astroid polygon
    if (point_in_polygon(pts, sht)) {
        shots.splice(index,1);
        // The Asteroid should be split in 2 and new velocity vectors be created
        if(scale > 1){
          var nVelocities = [getRandomVelocity(),getRandomVelocity()];
          asteroids[j][4]--;
          asteroids[j][2] = nVelocities[0][0];
          asteroids[j][3] = nVelocities[0][1];;
          var ast = [asteroids[j][0],asteroids[j][1],nVelocities[1][0],nVelocities[1][1],asteroids[j][4]];
          asteroids.push(ast);
        }
        else{
          asteroids.splice(j,1);
        }
        score++;
        document.getElementById('Score').innerHTML = "" + score;
    }
  }
}
function checkShipCollisionBullets(){
  for(p=0; p < shots.length;p++){
    var pts = [[x-4,y-4],[x,y+2],[x+4,y-4]];
    if (shots[p][4] > 50 && point_in_polygon(pts, shots[p])) {
      if (confirm('You Shot Yourself!!')) {
        if(score > hScore || hScore == null){
          var person = prompt("Please enter your name (Maximum limit 16)", "Harry Potter");
          localStorage.setItem('HScore', score);
          localStorage.setItem('HScoreName', person.slice(0,17));
        }
        location.reload();
      }
    }
  }
}
//Purpose: Check if an astroid collides with the ship
function checkShipCollision(){
  checkShipCollisionBullets();
  for (k=0; k < asteroids.length; k++){
    var scale = asteroids[k][4];
    var pt = [[x-4,y-4],[x,y+2],[x+4,y-4]];
    var points = [[asteroids[k][0]+10*scale, asteroids[k][1]+10*scale],[asteroids[k][0]+8*scale, asteroids[k][1]+5*scale],[asteroids[k][0]+10*scale, asteroids[k][1]-10*scale],[asteroids[k][0], asteroids[k][1]-5*scale],[asteroids[k][0]-10*scale, asteroids[k][1]-10*scale],[asteroids[k][0]-3*scale, asteroids[k][1]+2*scale],[asteroids[k][0]-10*scale, asteroids[k][1]+10*scale]];
    if (pts_in_polygon(points, pt)){// Impact
      if (confirm('You Lost!!')) {
        if(score > hScore || hScore == null){
          var person = prompt("Please enter your name (Maximum limit 16)", "Harry Potter");
          localStorage.setItem('HScore', score);
          localStorage.setItem('HScoreName', person.slice(0,17));
        }
        location.reload();
      }
    }
  }
}
// Restart game function
function restart() {
  location.reload();
}
update();

// Creates Asteroid every on each interval
setInterval(function(){
    asteroid();
}, interval);

// Adjusts interval; thus, affecting difficulty
setInterval(function(){
  if ( interval > 100){
    interval = interval - 100;
  }
}, 7000);

// Disable page scrolling
window.addEventListener("keydown", function(e) {
    // space and arrow keys
    if([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);

//Shooting and Movement events
document.body.addEventListener("keydown", function (e) {
    keys[e.keyCode] = true;

    //shots
    if (e.keyCode == 88){
      if(Math.abs(velX) > Math.abs(velY)){
        var vX = 2;
        var vY = Math.abs(velY/velX) * 2;
      } else {
        var vY = 2;
        var vX = Math.abs(velX/velY) * 2;
      }
      var multX = 1;
      var multY = 1;
      if (velX < 0){
        multX = -1;
      }
      if (velY < 0){
        multY = -1;
      }
      shots.push([x,y+5,vX*multX,vY*multY,0]);
    }
});
document.body.addEventListener("keyup", function (e) {
    keys[e.keyCode] = false;
  });
document.body.addEventListener("shot", function (e) {
    keys[e.keyCode] = false;
  });
</script>


</body>
</html>
